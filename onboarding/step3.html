<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification - Step 3</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700&amp;display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/components.js"></script>
    <link href="../assets/css/styles.css" rel="stylesheet" />
    <link rel="icon" type="image/svg+xml" href="../assets/images/favicon.svg" />
</head>

<body
    class="bg-aurora text-slate-800 dark:text-slate-100 antialiased selection:bg-primary/30 selection:text-primary-dark transition-colors duration-500 overflow-x-hidden">
    <app-navbar></app-navbar>
    <main class="relative z-10 pt-32 pb-20 min-h-screen flex items-center">
        <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 w-full">
            <div class="mb-12">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-sm font-semibold text-primary" data-i18n="onboarding.step3.of">Step 3 of 4</span>
                    <span class="text-sm text-slate-500" data-i18n="onboarding.step3.title">Verification &
                        Agreement</span>
                </div>
                <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-brand-gradient w-3/4 transition-all duration-500"></div>
                </div>
            </div>
            <div
                class="bg-white dark:bg-surface-dark rounded-[2rem] shadow-2xl border border-slate-200 dark:border-slate-700 p-8 md:p-12">
                <div class="mb-10">
                    <div class="w-16 h-16 bg-primary/10 rounded-2xl flex items-center justify-center mb-6">
                        <span class="material-symbols-outlined text-4xl text-primary">verified_user</span>
                    </div>
                    <h1 class="text-3xl font-black text-slate-900 dark:text-white mb-3"
                        data-i18n="onboarding.step3.header">Verification</h1>
                    <p class="text-slate-600 dark:text-slate-400 text-lg" data-i18n="onboarding.step3.subtitle">Complete
                        your registration</p>
                </div>
                <form id="verificationForm" class="space-y-8">
                    <div class="space-y-4">
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">upload_file</span>
                            <span data-i18n="onboarding.section.upload">Document Upload</span>
                        </h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400" data-i18n="onboarding.info.upload">Please
                            upload a government-issued ID for
                            verification</p>
                        <div
                            class="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl px-6 py-12 text-center hover:border-primary transition-colors">
                            <input type="file" id="docUpload" name="document" accept="image/*,application/pdf"
                                class="hidden">
                            <label for="docUpload" class="cursor-pointer block">
                                <span
                                    class="material-symbols-outlined text-5xl text-slate-400 mb-4 block">cloud_upload</span>
                                <p class="text-slate-700 dark:text-slate-300 font-semibold mb-2"
                                    data-i18n="onboarding.label.upload_box">Click to upload or drag
                                    and drop</p>
                                <p class="text-xs text-slate-500" data-i18n="onboarding.info.upload_types">PNG, JPG or
                                    PDF (max. 5MB)</p>
                            </label>
                        </div>
                        <div id="uploadedFile" class="hidden p-4 bg-primary/5 rounded-xl flex items-center gap-3">
                            <span class="material-symbols-outlined text-primary">description</span>
                            <span class="flex-1 text-sm font-medium" id="fileName"></span>
                            <button type="button"
                                onclick="document.getElementById('docUpload').value=''; this.parentElement.classList.add('hidden')"
                                class="text-slate-500 hover:text-emergency">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                    </div>
                    <div class="space-y-4 pt-6 border-t border-slate-200 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">gavel</span>
                            <span data-i18n="onboarding.section.terms">Terms & Conditions</span>
                        </h3>
                        <div
                            class="bg-slate-50 dark:bg-slate-800 rounded-xl p-6 max-h-64 overflow-y-auto custom-scrollbar">
                            <h4 class="font-bold mb-3">LifeLink Terms of Service</h4>
                            <div class="space-y-3 text-sm text-slate-600 dark:text-slate-400">
                                <p><strong>1. Acceptance:</strong> By using LifeLink, you agree to these terms.</p>
                                <p><strong>2. Eligibility:</strong> Users must meet medical and legal requirements for
                                    blood donation.</p>
                                <p><strong>3. Accuracy:</strong> You are responsible for providing accurate information.
                                </p>
                                <p><strong>4. Privacy:</strong> We protect your data per our Privacy Policy.</p>
                                <p><strong>5. Emergency Services:</strong> LifeLink facilitates connections but is not
                                    an emergency medical service.</p>
                                <p><strong>6. Liability:</strong> LifeLink is not liable for medical outcomes.</p>
                            </div>
                        </div>
                        <label class="flex items-start gap-3 cursor-pointer">
                            <input type="checkbox" name="terms" required
                                class="mt-1 w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary">
                            <span class="text-sm text-slate-700 dark:text-slate-300">
                                <span data-i18n="onboarding.label.terms_agree">I have read and agree to the Terms of
                                    Service</span> *
                            </span>
                        </label>
                    </div>
                    <div class="space-y-4 pt-6 border-t border-slate-200 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">shield</span>
                            <span data-i18n="onboarding.section.privacy">Privacy Policy</span>
                        </h3>
                        <div
                            class="bg-slate-50 dark:bg-slate-800 rounded-xl p-6 max-h-64 overflow-y-auto custom-scrollbar">
                            <h4 class="font-bold mb-3">Privacy Policy Highlights</h4>
                            <div class="space-y-3 text-sm text-slate-600 dark:text-slate-400">
                                <p><strong>Data Collection:</strong> We collect personal and medical information
                                    necessary for donor-patient matching.</p>
                                <p><strong>Data Usage:</strong> Your information is used solely for facilitating blood
                                    donations and improving our services.</p>
                                <p><strong>Data Sharing:</strong> We do not sell your data. Information is shared only
                                    with verified medical facilities when necessary.</p>
                                <p><strong>Security:</strong> We use industry-standard encryption and security measures.
                                </p>
                                <p><strong>Your Rights:</strong> You can access, modify, or delete your data at any
                                    time.</p>
                            </div>
                        </div>
                        <label class="flex items-start gap-3 cursor-pointer">
                            <input type="checkbox" name="privacy" required
                                class="mt-1 w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary">
                            <span class="text-sm text-slate-700 dark:text-slate-300">
                                <span data-i18n="onboarding.label.privacy_agree">I have read and agree to the Privacy
                                    Policy</span> *
                            </span>
                        </label>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4 pt-8">
                        <button type="button" onclick="history.back()"
                            class="flex-1 px-6 py-4 rounded-xl border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 font-bold text-center hover:bg-slate-50 dark:hover:bg-slate-800 transition-all"
                            data-i18n="onboarding.btn.back_step">
                            <span class="material-symbols-outlined inline-block mr-2">arrow_back</span>Back
                        </button>
                        <button type="submit"
                            class="flex-1 bg-brand-gradient text-white px-6 py-4 rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2"
                            data-i18n="onboarding.btn.complete">
                            <span>Complete Registration</span>
                            <span class="material-symbols-outlined">check_circle</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <script src="../assets/js/localization.js"></script>
    <script src="../assets/js/animations.js"></script>
    <script src="../assets/js/main.js"></script>
    <script type="module">
        import { auth, db } from '../assets/js/auth-service.js';
        import { saveUserProfile } from '../assets/js/db-service.js';
        import { handleAsyncOperation, showErrorNotification, showSuccessNotification } from '../assets/js/error-handler.js';

        const fileInput = document.getElementById('docUpload');
        const form = document.getElementById('verificationForm');

        fileInput.addEventListener('change', function (e) {
            if (this.files.length > 0) {
                const file = this.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    showErrorNotification('File size must be less than 5MB');
                    this.value = '';
                    return;
                }
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('uploadedFile').classList.remove('hidden');
            }
        });

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const user = auth.currentUser;
            if (!user) {
                showErrorNotification('Please login first');
                window.location.href = '../auth/login.html';
                return;
            }

            const result = await handleAsyncOperation(
                async () => {
                    await saveUserProfile(db, user, null, {
                        verificationDoc: fileInput.files[0]?.name || 'pending',
                        verificationStatus: 'pending',
                        onboardingComplete: true,
                        onboardingCompleteAt: new Date()
                    });
                },
                form.querySelector('button[type="submit"]'),
                'Completing...'
            );

            if (result.success) {
                showSuccessNotification('Registration completed successfully!');
                window.location.href = 'step4.html';
            }
        });
    </script>
</body>

</html>
