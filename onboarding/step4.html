<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to LifeLink!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700&amp;display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/components.js"></script>
    <link href="../assets/css/styles.css" rel="stylesheet" />
</head>

<body
    class="bg-aurora text-slate-800 dark:text-slate-100 antialiased selection:bg-primary/30 selection:text-primary-dark transition-colors duration-500 overflow-x-hidden">
    <app-navbar></app-navbar>
    <main class="relative z-10 pt-32 pb-20 min-h-screen flex items-center">
        <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 w-full">
            <div class="mb-12">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-sm font-semibold text-primary" data-i18n="onboarding.step1.of">Step 1 of 4</span>
                    <span class="text-sm text-primary" data-i18n="onboarding.step4.title">Complete!</span>
                </div>
                <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-brand-gradient w-full transition-all duration-500"></div>
                </div>
            </div>
            <div
                class="bg-white dark:bg-surface-dark rounded-[2rem] shadow-2xl border border-slate-200 dark:border-slate-700 p-8 md:p-12 text-center">
                <div
                    class="w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-8 animate-pulse">
                    <span class="material-symbols-outlined text-6xl text-primary">check_circle</span>
                </div>
                <h1 class="text-4xl font-black text-slate-900 dark:text-white mb-6" data-i18n="onboarding.step4.header">
                    Welcome to LifeLink!</h1>
                <p class="text-xl text-slate-600 dark:text-slate-400 mb-8 max-w-2xl mx-auto"
                    data-i18n="onboarding.step4.subtitle">
                    Your registration is complete. You're now part of a life-saving community.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="p-6 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                        <span
                            class="material-symbols-outlined text-4xl text-primary mb-3 block">volunteer_activism</span>
                        <h3 class="font-bold text-slate-900 dark:text-white mb-2"
                            data-i18n="onboarding.feature.matching.title">Matching System</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400"
                            data-i18n="onboarding.feature.matching.desc">Our AI finds the best donor-recipient
                            matches</p>
                    </div>
                    <div class="p-6 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                        <span
                            class="material-symbols-outlined text-4xl text-primary mb-3 block">notifications_active</span>
                        <h3 class="font-bold text-slate-900 dark:text-white mb-2"
                            data-i18n="onboarding.feature.alerts.title">Instant Alerts</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400"
                            data-i18n="onboarding.feature.alerts.desc">Get notified immediately when matched</p>
                    </div>
                    <div class="p-6 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                        <span class="material-symbols-outlined text-4xl text-primary mb-3 block">verified</span>
                        <h3 class="font-bold text-slate-900 dark:text-white mb-2"
                            data-i18n="onboarding.feature.verified.title">Verified Network</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400"
                            data-i18n="onboarding.feature.verified.desc">All participants are verified for safety
                        </p>
                    </div>
                </div>
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white"
                        data-i18n="onboarding.section.next_steps">Next Steps</h3>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a href="../dashboard/donor.html"
                            class="bg-brand-gradient text-white px-8 py-4 rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2">
                            <span class="material-symbols-outlined">dashboard</span>
                            <span data-i18n="onboarding.btn.go_dashboard">Go to Dashboard</span>
                        </a>
                        <a href="../index.html"
                            class="px-8 py-4 rounded-xl border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center gap-2"
                            data-i18n="onboarding.btn.back">
                            <span class="material-symbols-outlined">home</span>
                            <span>Back to Home</span>
                        </a>
                    </div>
                </div>
                <div class="mt-12 pt-8 border-t border-slate-200 dark:border-slate-700">
                    <p class="text-sm text-slate-500">
                        <span data-i18n="onboarding.info.help">Need help? Visit our Help Center</span>
                    </p>
                </div>
            </div>
        </div>
    </main>
    <script src="../assets/js/localization.js"></script>
    <script src="../assets/js/animations.js"></script>
    <script src="../assets/js/main.js"></script>
    <script type="module">
        import { auth, db, initAuthObserver } from '../assets/js/auth-service.js';
        import { saveUserProfile } from '../assets/js/db-service.js';

        initAuthObserver(async (user) => {
            if (user) {
                // Collect all data from localStorage
                const role = localStorage.getItem('onboarding_role');
                const donorData = JSON.parse(localStorage.getItem('onboarding_donor_data') || '{}');
                const hospitalData = JSON.parse(localStorage.getItem('onboarding_hospital_data') || '{}');
                const patientData = JSON.parse(localStorage.getItem('onboarding_patient_data') || '{}');
                const docName = localStorage.getItem('onboarding_doc_name');
                const verified = localStorage.getItem('onboarding_verified') === 'true';

                // Combine based on role
                let finalData = {};
                if (role === 'donor') finalData = donorData;
                else if (role === 'hospital') finalData = hospitalData;
                else if (role === 'patient') finalData = patientData;

                // Sync to Firestore
                try {
                    await saveUserProfile(db, user, role, {
                        ...finalData,
                        verificationDoc: docName || 'none',
                        isVerified: verified,
                        onboardingComplete: true,
                        updatedAt: new Date()
                    });
                    console.log('Onboarding data synced professionaly.');

                    // Update Dashboard Link dynamically
                    const dashLink = document.querySelector('a[href*="dashboard/"]');
                    if (dashLink) dashLink.href = `../dashboard/${role}.html`;

                    // Clear localStorage after successful save
                    localStorage.removeItem('onboarding_role');
                    localStorage.removeItem('onboarding_donor_data');
                    localStorage.removeItem('onboarding_hospital_data');
                    localStorage.removeItem('onboarding_patient_data');
                    localStorage.removeItem('onboarding_doc_name');
                    localStorage.removeItem('onboarding_verified');
                } catch (e) {
                    console.error('Failed to sync data:', e);
                }
            } else {
                // If not logged in, redirect to step 1
                window.location.href = 'step1.html';
            }
        });
    </script>
</body>

</html>